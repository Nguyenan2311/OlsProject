<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Profile với Bootstrap</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Font Awesome Icons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

        <style>
            body {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .profile-container {
                margin-top: 2rem;
                margin-bottom: 2rem;
            }

            .profile-image-container {
                position: relative;
                display: inline-block;
                margin-bottom: 1rem;
            }

            .profile-image {
                width: 150px;
                height: 150px;
                object-fit: cover;
                border: 4px solid #fff;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                transition: transform 0.3s ease;
            }

            .profile-image:hover {
                transform: scale(1.05);
            }

            .image-overlay {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.6);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                transition: opacity 0.3s ease;
                cursor: pointer;
            }

            .image-overlay:hover {
                opacity: 1;
            }

            .image-overlay i {
                color: white;
                font-size: 2rem;
            }

            .card {
                border: none;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                backdrop-filter: blur(10px);
                background: rgba(255,255,255,0.95);
            }

            .card-header {
                border-radius: 15px 15px 0 0 !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: none;
            }

            .btn-custom {
                border-radius: 25px;
                padding: 8px 20px;
                font-weight: 500;
                transition: all 0.3s ease;
            }

            .btn-custom:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }

            .form-control, .form-select {
                border-radius: 10px;
                border: 2px solid #e9ecef;
                transition: border-color 0.3s ease;
            }

            .form-control:focus, .form-select:focus {
                border-color: #667eea;
                box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            }

            .loading-spinner {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 10;
            }

            .fade-in {
                animation: fadeIn 0.5s ease-in;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .success-message {
                display: none;
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
            }

            .image-preview {
                max-width: 100%;
                max-height: 200px;
                margin-top: 10px;
                border-radius: 10px;
                display: none;
            }

            .gallery-container {
                margin-top: 2rem;
            }

            .gallery-item {
                position: relative;
                aspect-ratio: 1;
                border: 2px dashed #dee2e6;
                border-radius: 15px;
                overflow: hidden;
                transition: all 0.3s ease;
                cursor: pointer;
                background: #f8f9fa;
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 200px;
            }

            .gallery-item:hover {
                border-color: #667eea;
                background: #f0f2ff;
                transform: translateY(-2px);
            }

            .gallery-item.has-image {
                border-style: solid;
                border-color: #667eea;
            }

            .gallery-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                transition: transform 0.3s ease;
            }

            .gallery-item:hover img {
                transform: scale(1.05);
            }

            .gallery-placeholder {
                text-align: center;
                color: #6c757d;
                padding: 20px;
            }

            .gallery-placeholder i {
                font-size: 2rem;
                margin-bottom: 10px;
                display: block;
            }

            .gallery-overlay {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                transition: opacity 0.3s ease;
                gap: 10px;
            }

            .gallery-item:hover .gallery-overlay {
                opacity: 1;
            }

            .gallery-btn {
                background: rgba(255,255,255,0.9);
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
            }

            .gallery-btn:hover {
                background: white;
                transform: scale(1.1);
            }

            .gallery-loading {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 10;
            }
        </style>
    </head>
    <body>
        <div class="container profile-container">
            <div class="row justify-content-center">
                <div class="col-md-8 col-lg-6">
                    <!-- Main Profile Card -->
                    <div class="card fade-in">
                        <div class="card-header text-white">
                            <h4 class="card-title mb-0">
                                <i class="fas fa-user me-2"></i>
                                Thông tin Profile
                            </h4>
                        </div>
                        <div class="card-body">
                            <!-- Profile Image Section -->
                            <div class="text-center mb-4">
                                <div class="profile-image-container">
                                    <img id="profileImage" 
                                         src="https://via.placeholder.com/150x150/667eea/ffffff?text=Avatar" 
                                         alt="Profile" 
                                         class="rounded-circle profile-image">

                                    <div class="image-overlay" onclick="triggerFileInput()">
                                        <i class="fas fa-camera"></i>
                                    </div>

                                    <!-- Loading Spinner -->
                                    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Đang tải...</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Upload Buttons -->
                                <div class="mt-3">
                                    <button class="btn btn-outline-primary btn-custom me-2" onclick="triggerFileInput()">
                                        <i class="fas fa-upload me-1"></i>
                                        Tải ảnh lên
                                    </button>
                                    <button class="btn btn-outline-danger btn-custom" onclick="removeImage()">
                                        <i class="fas fa-trash me-1"></i>
                                        Xóa ảnh
                                    </button>
                                </div>

                                <!-- Hidden File Input -->
                                <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                            </div>

                            <!-- Profile Form -->
                            <form id="profileForm" onsubmit="handleFormSubmit(event)">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="firstName" class="form-label">
                                            <i class="fas fa-user me-1"></i>
                                            Họ
                                        </label>
                                        <input type="text" class="form-control" id="firstName" 
                                               placeholder="Nhập họ của bạn" value="Nguyễn" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="lastName" class="form-label">
                                            <i class="fas fa-user me-1"></i>
                                            Tên
                                        </label>
                                        <input type="text" class="form-control" id="lastName" 
                                               placeholder="Nhập tên của bạn" value="Văn A" required>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="email" class="form-label">
                                        <i class="fas fa-envelope me-1"></i>
                                        Email
                                    </label>
                                    <input type="email" class="form-control" id="email" 
                                           placeholder="example@email.com" value="nguyenvana@email.com" required>
                                </div>

                                <div class="mb-3">
                                    <label for="phone" class="form-label">
                                        <i class="fas fa-phone me-1"></i>
                                        Số điện thoại
                                    </label>
                                    <input type="tel" class="form-control" id="phone" 
                                           placeholder="0123456789" value="0123456789">
                                </div>

                                <div class="mb-3">
                                    <label for="bio" class="form-label">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Giới thiệu
                                    </label>
                                    <textarea class="form-control" id="bio" rows="3" 
                                              placeholder="Viết vài dòng giới thiệu về bản thân...">Tôi là một developer đam mê công nghệ và luôn học hỏi những điều mới.</textarea>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="birthDate" class="form-label">
                                            <i class="fas fa-calendar me-1"></i>
                                            Ngày sinh
                                        </label>
                                        <input type="date" class="form-control" id="birthDate" value="1990-01-01">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="gender" class="form-label">
                                            <i class="fas fa-venus-mars me-1"></i>
                                            Giới tính
                                        </label>
                                        <select class="form-select" id="gender">
                                            <option value="">Chọn giới tính</option>
                                            <option value="male" selected>Nam</option>
                                            <option value="female">Nữ</option>
                                            <option value="other">Khác</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Action Buttons -->
                                <div class="d-flex justify-content-end gap-2">
                                    <button type="button" class="btn btn-outline-secondary btn-custom" onclick="resetForm()">
                                        <i class="fas fa-times me-1"></i>
                                        Hủy
                                    </button>
                                    <button type="submit" class="btn btn-primary btn-custom">
                                        <i class="fas fa-save me-1"></i>
                                        Lưu thay đổi
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Additional Info Card -->
                    <div class="card mt-4 fade-in">
                        <div class="card-header bg-info text-white">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-cog me-2"></i>
                                Cài đặt ảnh đại diện
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info" role="alert">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Lưu ý:</strong>
                                <ul class="mb-0 mt-2">
                                    <li>Kích thước ảnh tối đa: 5MB</li>
                                    <li>Định dạng được hỗ trợ: JPG, PNG, GIF</li>
                                    <li>Kích thước khuyến nghị: 400x400 pixels</li>
                                    <li>Ảnh sẽ được cắt thành hình vuông tự động</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Gallery Section -->
                    <div class="card mt-4 fade-in gallery-container">
                        <div class="card-header bg-success text-white">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-images me-2"></i>
                                Ảnh mô tả (4 ảnh)
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <!-- Gallery Item 1 -->
                                <div class="col-md-6">
                                    <div class="gallery-item" onclick="triggerGalleryInput(0)" 
                                         ondrop="handleGalleryDrop(event, 0)" 
                                         ondragover="handleGalleryDragOver(event)"
                                         ondragleave="handleGalleryDragLeave(event)">

                                        <div class="gallery-placeholder" id="placeholder-0">
                                            <i class="fas fa-plus"></i>
                                            <div>Thêm ảnh 1</div>
                                            <small>Kéo thả hoặc click để chọn</small>
                                        </div>

                                        <img id="gallery-img-0" style="display: none;" alt="Gallery Image 1">

                                        <div class="gallery-overlay">
                                            <button class="gallery-btn" onclick="event.stopPropagation(); triggerGalleryInput(0)" title="Thay đổi ảnh">
                                                <i class="fas fa-edit text-primary"></i>
                                            </button>
                                            <button class="gallery-btn" onclick="event.stopPropagation(); removeGalleryImage(0)" title="Xóa ảnh">
                                                <i class="fas fa-trash text-danger"></i>
                                            </button>
                                            <button class="gallery-btn" onclick="event.stopPropagation(); viewGalleryImage(0)" title="Xem full">
                                                <i class="fas fa-expand text-info"></i>
                                            </button>
                                        </div>

                                        <div class="gallery-loading" id="loading-0" style="display: none;">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Đang tải...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gallery Item 2 -->
                                <div class="col-md-6">
                                    <div class="gallery-item" onclick="triggerGalleryInput(1)" 
                                         ondrop="handleGalleryDrop(event, 1)" 
                                         ondragover="handleGalleryDragOver(event)"
                                         ondragleave="handleGalleryDragLeave(event)">

                                        <div class="gallery-placeholder" id="placeholder-1">
                                            <i class="fas fa-plus"></i>
                                            <div>Thêm ảnh 2</div>
                                            <small>Kéo thả hoặc click để chọn</small>
                                        </div>

                                        <img id="gallery-img-1" style="display: none;" alt="Gallery Image 2">

                                        <div class="gallery-overlay">
                                            <button class="gallery-btn" onclick="event.stopPropagation(); triggerGalleryInput(1)" title="Thay đổi ảnh">
                                                <i class="fas fa-edit text-primary"></i>
                                            </button>
                                            <button class="gallery-btn" onclick="event.stopPropagation(); removeGalleryImage(1)" title="Xóa ảnh">
                                                <i class="fas fa-trash text-danger"></i>
                                            </button>
                                            <button class="gallery-btn" onclick="event.stopPropagation(); viewGalleryImage(1)" title="Xem full">
                                                <i class="fas fa-expand text-info"></i>
                                            </button>
                                        </div>

                                        <div class="gallery-loading" id="loading-1" style="display: none;">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Đang tải...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gallery Item 3 -->
                                <div class="col-md-6">
                                    <div class="gallery-item" onclick="triggerGalleryInput(2)" 
                                         ondrop="handleGalleryDrop(event, 2)" 
                                         ondragover="handleGalleryDragOver(event)"
                                         ondragleave="handleGalleryDragLeave(event)">

                                        <div class="gallery-placeholder" id="placeholder-2">
                                            <i class="fas fa-plus"></i>
                                            <div>Thêm ảnh 3</div>
                                            <small>Kéo thả hoặc click để chọn</small>
                                        </div>

                                        <img id="gallery-img-2" style="display: none;" alt="Gallery Image 3">

                                        <div class="gallery-overlay">
                                            <button class="gallery-btn" onclick="event.stopPropagation(); triggerGalleryInput(2)" title="Thay đổi ảnh">
                                                <i class="fas fa-edit text-primary"></i>
                                            </button>
                                            <button class="gallery-btn" onclick="event.stopPropagation(); removeGalleryImage(2)" title="Xóa ảnh">
                                                <i class="fas fa-trash text-danger"></i>
                                            </button>
                                            <button class="gallery-btn" onclick="event.stopPropagation(); viewGalleryImage(2)" title="Xem full">
                                                <i class="fas fa-expand text-info"></i>
                                            </button>
                                        </div>

                                        <div class="gallery-loading" id="loading-2" style="display: none;">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Đang tải...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gallery Item 4 -->
                                <div class="col-md-6">
                                    <div class="gallery-item" onclick="triggerGalleryInput(3)" 
                                         ondrop="handleGalleryDrop(event, 3)" 
                                         ondragover="handleGalleryDragOver(event)"
                                         ondragleave="handleGalleryDragLeave(event)">

                                        <div class="gallery-placeholder" id="placeholder-3">
                                            <i class="fas fa-plus"></i>
                                            <div>Thêm ảnh 4</div>
                                            <small>Kéo thả hoặc click để chọn</small>
                                        </div>

                                        <img id="gallery-img-3" style="display: none;" alt="Gallery Image 4">

                                        <div class="gallery-overlay">
                                            <button class="gallery-btn" onclick="event.stopPropagation(); triggerGalleryInput(3)" title="Thay đổi ảnh">
                                                <i class="fas fa-edit text-primary"></i>
                                            </button>
                                            <button class="gallery-btn" onclick="event.stopPropagation(); removeGalleryImage(3)" title="Xóa ảnh">
                                                <i class="fas fa-trash text-danger"></i>
                                            </button>
                                            <button class="gallery-btn" onclick="event.stopPropagation(); viewGalleryImage(3)" title="Xem full">
                                                <i class="fas fa-expand text-info"></i>
                                            </button>
                                        </div>

                                        <div class="gallery-loading" id="loading-3" style="display: none;">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Đang tải...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Gallery Actions -->
                            <div class="mt-3 text-center">
                                <button class="btn btn-outline-primary btn-custom me-2" onclick="uploadAllGallery()">
                                    <i class="fas fa-upload me-1"></i>
                                    Tải tất cả ảnh
                                </button>
                                <button class="btn btn-outline-danger btn-custom" onclick="clearAllGallery()">
                                    <i class="fas fa-trash me-1"></i>
                                    Xóa tất cả
                                </button>
                            </div>

                            <!-- Hidden File Inputs for Gallery -->
                            <input type="file" id="galleryInput-0" accept="image/*" style="display: none;" onchange="handleGalleryUpload(event, 0)">
                            <input type="file" id="galleryInput-1" accept="image/*" style="display: none;" onchange="handleGalleryUpload(event, 1)">
                            <input type="file" id="galleryInput-2" accept="image/*" style="display: none;" onchange="handleGalleryUpload(event, 2)">
                            <input type="file" id="galleryInput-3" accept="image/*" style="display: none;" onchange="handleGalleryUpload(event, 3)">
                            <input type="file" id="galleryInputAll" accept="image/*" multiple style="display: none;" onchange="handleMultipleGalleryUpload(event)">
                        </div>
                    </div>

                    <!-- Image Viewer Modal -->
                    <div class="modal fade" id="imageViewerModal" tabindex="-1">
                        <div class="modal-dialog modal-lg modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Xem ảnh</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body text-center">
                                    <img id="modalImage" class="img-fluid rounded" alt="Full size image">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                <strong>Thành công!</strong> Thông tin profile đã được cập nhật.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script>
                                // Global variables
                                let currentImageFile = null;
                                const defaultImage = "https://via.placeholder.com/150x150/667eea/ffffff?text=Avatar";

                                // Trigger file input
                                function triggerFileInput() {
                                    document.getElementById('fileInput').click();
                                }

                                // Handle image upload
                                function handleImageUpload(event) {
                                    const file = event.target.files[0];
                                    if (!file)
                                        return;

                                    // Validate file size (5MB max)
                                    if (file.size > 5 * 1024 * 1024) {
                                        alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn 5MB.');
                                        return;
                                    }

                                    // Validate file type
                                    if (!file.type.startsWith('image/')) {
                                        alert('Vui lòng chọn file ảnh hợp lệ!');
                                        return;
                                    }

                                    // Show loading spinner
                                    showLoading(true);

                                    // Simulate upload delay
                                    setTimeout(() => {
                                        const reader = new FileReader();
                                        reader.onload = function (e) {
                                            document.getElementById('profileImage').src = e.target.result;
                                            currentImageFile = file;
                                            showLoading(false);

                                            // Show success animation
                                            const img = document.getElementById('profileImage');
                                            img.style.transform = 'scale(1.1)';
                                            setTimeout(() => {
                                                img.style.transform = 'scale(1)';
                                            }, 300);
                                        };
                                        reader.readAsDataURL(file);
                                    }, 1000);
                                }

                                // Remove image
                                function removeImage() {
                                    document.getElementById('profileImage').src = defaultImage;
                                    document.getElementById('fileInput').value = '';
                                    currentImageFile = null;

                                    // Animation
                                    const img = document.getElementById('profileImage');
                                    img.style.opacity = '0.5';
                                    setTimeout(() => {
                                        img.style.opacity = '1';
                                    }, 300);
                                }

                                // Show/hide loading spinner
                                function showLoading(show) {
                                    const spinner = document.getElementById('loadingSpinner');
                                    const overlay = document.querySelector('.image-overlay');

                                    if (show) {
                                        spinner.style.display = 'block';
                                        overlay.style.opacity = '0.8';
                                        overlay.style.pointerEvents = 'none';
                                    } else {
                                        spinner.style.display = 'none';
                                        overlay.style.opacity = '0';
                                        overlay.style.pointerEvents = 'auto';
                                    }
                                }

                                // Handle form submission
                                function handleFormSubmit(event) {
                                    event.preventDefault();

                                    // Get form data
                                    const formData = {
                                        firstName: document.getElementById('firstName').value,
                                        lastName: document.getElementById('lastName').value,
                                        email: document.getElementById('email').value,
                                        phone: document.getElementById('phone').value,
                                        bio: document.getElementById('bio').value,
                                        birthDate: document.getElementById('birthDate').value,
                                        gender: document.getElementById('gender').value,
                                        profileImage: currentImageFile,
                                        galleryImages: galleryImages.filter(img => img !== null) // Chỉ lấy ảnh đã upload
                                    };

                                    // Validate required fields
                                    if (!formData.firstName || !formData.lastName || !formData.email) {
                                        alert('Vui lòng điền đầy đủ thông tin bắt buộc!');
                                        return;
                                    }

                                    // Simulate form submission
                                    const submitBtn = event.target.querySelector('button[type="submit"]');
                                    const originalText = submitBtn.innerHTML;
                                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Đang lưu...';
                                    submitBtn.disabled = true;

                                    setTimeout(() => {
                                        // Reset button
                                        submitBtn.innerHTML = originalText;
                                        submitBtn.disabled = false;

                                        // Show success message
                                        showSuccessMessage();

                                        // Log form data (in real app, send to server)
                                        console.log('Form data:', formData);
                                    }, 2000);
                                }

                                // Reset form
                                function resetForm() {
                                    if (confirm('Bạn có chắc muốn hủy các thay đổi?')) {
                                        document.getElementById('profileForm').reset();
                                        removeImage();
                                    }
                                }

                                // Show success message
                                function showSuccessMessage() {
                                    const successMsg = document.getElementById('successMessage');
                                    successMsg.style.display = 'block';

                                    setTimeout(() => {
                                        successMsg.style.display = 'none';
                                    }, 5000);
                                }

                                // Add smooth scrolling and animations
                                document.addEventListener('DOMContentLoaded', function () {
                                    // Add fade-in animation to cards
                                    const cards = document.querySelectorAll('.card');
                                    cards.forEach((card, index) => {
                                        card.style.animationDelay = `${index * 0.2}s`;
                                    });

                                    // Add form validation styling
                                    const inputs = document.querySelectorAll('.form-control, .form-select');
                                    inputs.forEach(input => {
                                        input.addEventListener('blur', function () {
                                            if (this.checkValidity()) {
                                                this.classList.remove('is-invalid');
                                                this.classList.add('is-valid');
                                            } else {
                                                this.classList.remove('is-valid');
                                                this.classList.add('is-invalid');
                                            }
                                        });
                                    });
                                });

                                // Drag and drop functionality
                                const profileImageContainer = document.querySelector('.profile-image-container');

                                profileImageContainer.addEventListener('dragover', function (e) {
                                    e.preventDefault();
                                    this.style.opacity = '0.7';
                                });

                                profileImageContainer.addEventListener('dragleave', function (e) {
                                    e.preventDefault();
                                    this.style.opacity = '1';
                                });

                                profileImageContainer.addEventListener('drop', function (e) {
                                    e.preventDefault();
                                    this.style.opacity = '1';

                                    const files = e.dataTransfer.files;
                                    if (files.length > 0) {
                                        const fileInput = document.getElementById('fileInput');
                                        fileInput.files = files;
                                        handleImageUpload({target: {files: files}});
                                    }
                                });

                                // Gallery functionality
                                let galleryImages = [null, null, null, null];

                                // Trigger gallery file input
                                function triggerGalleryInput(index) {
                                    document.getElementById(`galleryInput-${index}`).click();
                                }

                                // Handle gallery image upload
                                function handleGalleryUpload(event, index) {
                                    const file = event.target.files[0];
                                    if (!file)
                                        return;

                                    if (!validateImageFile(file))
                                        return;

                                    showGalleryLoading(index, true);

                                    setTimeout(() => {
                                        const reader = new FileReader();
                                        reader.onload = function (e) {
                                            const img = document.getElementById(`gallery-img-${index}`);
                                            const placeholder = document.getElementById(`placeholder-${index}`);
                                            const container = img.parentElement;

                                            img.src = e.target.result;
                                            img.style.display = 'block';
                                            placeholder.style.display = 'none';
                                            container.classList.add('has-image');

                                            galleryImages[index] = file;
                                            showGalleryLoading(index, false);

                                            // Animation
                                            img.style.opacity = '0';
                                            setTimeout(() => {
                                                img.style.transition = 'opacity 0.5s ease';
                                                img.style.opacity = '1';
                                            }, 100);
                                        };
                                        reader.readAsDataURL(file);
                                    }, 800);
                                }

                                // Remove gallery image
                                function removeGalleryImage(index) {
                                    const img = document.getElementById(`gallery-img-${index}`);
                                    const placeholder = document.getElementById(`placeholder-${index}`);
                                    const container = img.parentElement;
                                    const input = document.getElementById(`galleryInput-${index}`);

                                    img.style.display = 'none';
                                    placeholder.style.display = 'block';
                                    container.classList.remove('has-image');
                                    input.value = '';
                                    galleryImages[index] = null;

                                    // Animation
                                    container.style.transform = 'scale(0.95)';
                                    setTimeout(() => {
                                        container.style.transform = 'scale(1)';
                                    }, 200);
                                }

                                // View gallery image in modal
                                function viewGalleryImage(index) {
                                    const img = document.getElementById(`gallery-img-${index}`);
                                    if (img.src && img.style.display !== 'none') {
                                        document.getElementById('modalImage').src = img.src;
                                        new bootstrap.Modal(document.getElementById('imageViewerModal')).show();
                                    }
                                }

                                // Show/hide gallery loading
                                function showGalleryLoading(index, show) {
                                    const loading = document.getElementById(`loading-${index}`);
                                    loading.style.display = show ? 'block' : 'none';
                                }

                                // Upload all gallery images
                                function uploadAllGallery() {
                                    document.getElementById('galleryInputAll').click();
                                }

                                // Handle multiple gallery upload
                                function handleMultipleGalleryUpload(event) {
                                    const files = Array.from(event.target.files);

                                    files.slice(0, 4).forEach((file, index) => {
                                        if (galleryImages[index] === null) {
                                            const fakeEvent = {target: {files: [file]}};
                                            handleGalleryUpload(fakeEvent, index);
                                        }
                                    });
                                }

    // Clear all gallery images
                                function clearAllGallery() {
                                    if (confirm('Bạn có chắc muốn xóa tất cả ảnh trong gallery?')) {
                                        for (let i = 0; i < 4; i++) {
                                            if (galleryImages[i] !== null) {
                                                removeGalleryImage(i);
                                            }
                                        }
                                    }
                                }

    // Drag and drop for gallery
                                function handleGalleryDragOver(event) {
                                    event.preventDefault();
                                    event.currentTarget.style.borderColor = '#667eea';
                                    event.currentTarget.style.background = '#f0f2ff';
                                }

                                function handleGalleryDragLeave(event) {
                                    event.preventDefault();
                                    event.currentTarget.style.borderColor = '#dee2e6';
                                    event.currentTarget.style.background = '#f8f9fa';
                                }

                                function handleGalleryDrop(event, index) {
                                    event.preventDefault();
                                    event.currentTarget.style.borderColor = '#dee2e6';
                                    event.currentTarget.style.background = '#f8f9fa';

                                    const files = event.dataTransfer.files;
                                    if (files.length > 0) {
                                        const fakeEvent = {target: {files: files}};
                                        handleGalleryUpload(fakeEvent, index);
                                    }
                                }

    // Validate image file
                                function validateImageFile(file) {
                                    if (file.size > 5 * 1024 * 1024) {
                                        alert('Kích thước file quá lớn! Vui lòng chọn file nhỏ hơn 5MB.');
                                        return false;
                                    }

                                    if (!file.type.startsWith('image/')) {
                                        alert('Vui lòng chọn file ảnh hợp lệ!');
                                        return false;
                                    }

                                    return true;
                                }
        </script>
    </body>
</html>